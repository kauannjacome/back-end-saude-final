generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum NotificationType {
  PRAZO
  PRIORIDADE
  QUANTIDADE_ATINGIDA
  AGENDAMENTO
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  VIEW
}

enum Status {
  IN_PROGRESS
  APPROVED
  DENIED
  RETURNED
}

enum UnitMeasure {
  MG
  G
  MCG
  KG
  ML
  L
  AMP
  COMP
  CAPS
  FR
  TUB
  DOSE
  UI
  CX
  UN
  SESSION
  DAILY
  MEASURE
  OINTMENT
  CREAM
  GEL
}

enum Priority {
  ELECTIVE
  URGENCY
  EMERGENCY
}

enum Sex {
  MALE
  FEMALE
  OTHER
  NOT_INFORMED
}

enum Role {
  ADMIN_MANAGER
  ADMIN_MUNICIPAL
  TYPIST
}

enum Relationship {
  FRIEND
  PARENT
  CAREGIVER
  BOYFRIEND_GIRLFRIEND
  SPOUSE
  UNCLE_AUNT
  SIBLING
  COUSIN
  NEPHEW_NIECE
}

enum ResourceOrigin {
  NOT_SPECIFIED
  MUNICIPAL
  STATE
  FEDERAL
}

enum TypeDeclaration {
  NONE
  RESIDENCE_PEC
  RESIDENCE_CADSUS
  UPDATE_CADSUS
  COST_HELP
  HIGH_COST_EXAM
  AUTHORIZATION
  WITHDRAWAL
  AIH
  TRANSPORT
  CER
  CONTINUOUS_MEDICATION
  PHARMACEUTICAL_ASSISTANCE
}

enum DocumentCategory {
  PRINTED_DOCUMENT
  DIGITAL_DOCUMENT
}

enum PatientDocumentType {
  BIRTH_CERTIFICATE
  MARRIAGE_CERTIFICATE
  RG
  CPF
  CNH
  VOTER_ID
  PROOF_OF_RESIDENCE
  WORK_CARD
  SUS_CARD
  SUS_MIRROR
  PIS_PASEP
  RESERVIST_CERTIFICATE
  GOV_BR
  DIGITAL_CNH
  DIGITAL_RG
  OTHER
}

model Subscriber {
  id                      Int                      @id @default(autoincrement())
  uuid                    String                   @unique @default(uuid()) @db.Uuid
  name                    String
  municipalityName        String                   @map("municipality_name")
  email                   String
  telephone               String
  cnpj                    String                   @unique
  postalCode              String                   @map("postal_code")
  city                    String
  neighborhood            String
  street                  String
  number                  String
  stateName               String                   @map("state_name")
  stateAcronym            String                   @map("state_acronym")
  stateLogo               String?                  @map("state_logo")
  municipalLogo           String?                  @map("municipal_logo")
  administrationLogo      String?                  @map("administration_logo")
  payment                 Boolean                  @default(true)
  isBlocked               Boolean                  @default(false) @map("is_blocked")
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @updatedAt @map("updated_at")
  deletedAt               DateTime?                @map("deleted_at")
  auditLogs               AuditLog[]
  cares                   Care[]
  careRegulations         CareRegulation[]
  folders                 Folder[]
  groups                  Group[]
  notifications           Notification[]
  patients                Patient[]
  patientDocument         PatientDocument[]
  professionals           Professional[]
  regulations             Regulation[]
  suppliers               Supplier[]
  units                   Unit[]
  whatsappConfig          WhatsAppConfig?
  professionalEmployments ProfessionalEmployment[]

  @@map("subscriber")
}

model Unit {
  id             Int        @id @default(autoincrement())
  uuid           String     @unique @default(uuid()) @db.Uuid
  subscriberId   Int        @map("subscriber_id")
  name           String
  nameNormalized String?    @map("name_normalized")
  createdAt      DateTime   @default(now()) @map("created_at")
  updatedAt      DateTime   @updatedAt @map("updated_at")
  deletedAt      DateTime?  @map("deleted_at")
  subscriber     Subscriber @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@index([subscriberId])
  @@map("unit")
}

model AuditLog {
  id           Int           @id @default(autoincrement())
  uuid         String        @unique @default(uuid()) @db.Uuid
  subscriberId Int           @map("subscriber_id")
  actorId      Int?          @map("actor_id")
  objectType   String        @map("object_type")
  objectId     Int           @map("object_id")
  action       AuditAction
  detail       Json
  occurredAt   DateTime      @default(now()) @map("occurred_at")
  actor        Professional? @relation(fields: [actorId], references: [id])
  subscriber   Subscriber    @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@index([subscriberId])
  @@index([actorId])
  @@index([objectType, objectId])
  @@map("audit_log")
}

model Care {
  id              Int              @id @default(autoincrement())
  uuid            String           @unique @default(uuid()) @db.Uuid
  subscriberId    Int              @map("subscriber_id")
  name            String
  nameNormalized  String?          @map("name_normalized")
  acronym         String?
  description     String?          @db.Text
  status          Status?          @default(IN_PROGRESS)
  resourceOrigin  ResourceOrigin?  @default(NOT_SPECIFIED) @map("resource_origin")
  priority        Priority?        @default(ELECTIVE)
  unitMeasure     UnitMeasure      @map("unit_measure")
  typeDeclaration TypeDeclaration? @map("type_declaration")
  value           Float?
  amount          Int?
  minDeadlineDays Int?             @map("min_deadline_days")
  groupId         Int?             @map("group_id")
  professionalId  Int?             @map("professional_id")
  supplierId      Int?             @map("supplier_id")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  deletedAt       DateTime?        @map("deleted_at")
  group           Group?           @relation(fields: [groupId], references: [id])
  professional    Professional?    @relation(fields: [professionalId], references: [id])
  subscriber      Subscriber       @relation(fields: [subscriberId], references: [id], onDelete: Cascade)
  supplier        Supplier?        @relation(fields: [supplierId], references: [id])
  regulations     CareRegulation[]

  @@index([subscriberId])
  @@index([groupId])
  @@index([professionalId])
  @@index([subscriberId, status, deletedAt])
  @@map("care")
}

model Folder {
  id             Int           @id @default(autoincrement())
  uuid           String        @unique @default(uuid()) @db.Uuid
  subscriberId   Int           @map("subscriber_id")
  name           String
  nameNormalized String?       @map("name_normalized")
  idCode         String?       @map("id_code")
  description    String?       @db.Text
  responsibleId  Int?          @map("responsible_id")
  startDate      DateTime?     @map("start_date")
  endDate        DateTime?     @map("end_date")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  deletedAt      DateTime?     @map("deleted_at")
  responsible    Professional? @relation("ProfessionalResponsible", fields: [responsibleId], references: [id])
  subscriber     Subscriber    @relation(fields: [subscriberId], references: [id], onDelete: Cascade)
  regulations    Regulation[]

  @@index([subscriberId])
  @@map("folder")
}

model Group {
  id           Int        @id @default(autoincrement())
  uuid         String     @unique @default(uuid()) @db.Uuid
  subscriberId Int?       @map("subscriber_id")
  name         String
  description  String?    @db.Text
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  deletedAt    DateTime?  @map("deleted_at")
  cares        Care[]
  subscriber   Subscriber? @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@index([id])
  @@index([subscriberId])
  @@map("group")
}

model Patient {
  id                   Int               @id @default(autoincrement())
  uuid                 String            @unique @default(uuid()) @db.Uuid
  subscriberId         Int               @map("subscriber_id")
  cpf                  String
  cns                  String?
  name                 String
  nameNormalized       String?           @map("name_normalized")
  socialName           String?           @map("social_name")
  gender               String?
  race                 String?
  sex                  String?
  birthDate            DateTime          @map("birth_date")
  deathDate            DateTime?         @map("death_date")
  motherName           String?           @map("mother_name")
  fatherName           String?           @map("father_name")
  phone                String?
  email                String?
  postalCode           String?           @map("postal_code")
  state                String?
  city                 String?
  address              String?
  number               String?
  complement           String?
  neighborhood         String?
  nationality          String?
  naturalness          String?
  maritalStatus        String?           @map("marital_status")
  bloodType            String?           @map("blood_type")
  passwordHash         String?           @map("password_hash")
  isPasswordTemp       Boolean           @default(false) @map("is_password_temp")
  numberTry            Int?              @default(0) @map("number_try")
  isBlocked            Boolean           @default(false) @map("is_blocked")
  acceptedTerms        Boolean           @default(false) @map("accepted_terms")
  acceptedTermsAt      DateTime?         @map("accepted_terms_at")
  acceptedTermsVersion String?           @map("accepted_terms_version")
  createdAt            DateTime          @default(now()) @map("created_at")
  updatedAt            DateTime          @updatedAt @map("updated_at")
  deletedAt            DateTime?         @map("deleted_at")
  numberUnlock         Int?              @default(0) @map("number_unlock")
  subscriber           Subscriber        @relation(fields: [subscriberId], references: [id], onDelete: Cascade)
  patientDocument      PatientDocument[]
  regulations          Regulation[]      @relation("PatientRegulation")
  responsibleFor       Regulation[]      @relation("ResponsibleRegulation")

  @@unique([subscriberId, cpf])
  @@index([subscriberId])
  @@map("patient")
}

model Professional {
  id                   Int                      @id @default(autoincrement())
  uuid                 String                   @unique @default(uuid()) @db.Uuid
  cpf                  String
  name                 String?
  nameNormalized       String?                  @map("name_normalized")
  cargo                String?
  sex                  Sex?
  birthDate            DateTime?                @map("birth_date")
  phoneNumber          String?                  @map("phone_number")
  email                String?
  cns                  String?
  professionalRegistry String?                  @map("professional_registry")
  registryType         String?                  @map("registry_type")
  registryNumber       String?                  @map("registry_number")
  registryState        String?                  @map("registry_state")
  role                 Role?                    @default(TYPIST)
  passwordHash         String?                  @map("password_hash")
  isPasswordTemp       Boolean                  @default(false) @map("is_password_temp")
  numberTry            Int?                     @default(0) @map("number_try")
  isBlocked            Boolean                  @default(false) @map("is_blocked")
  acceptedTerms        Boolean                  @default(false) @map("accepted_terms")
  acceptedTermsAt      DateTime?                @map("accepted_terms_at")
  acceptedTermsVersion String?                  @map("accepted_terms_version")
  resetToken           String?                  @map("reset_token")
  resetTokenExpiry     DateTime?                @map("reset_token_expiry")
  createdAt            DateTime                 @default(now()) @map("created_at")
  updatedAt            DateTime                 @updatedAt @map("updated_at")
  deletedAt            DateTime?                @map("deleted_at")
  address              String?
  city                 String?
  complement           String?
  deathDate            DateTime?                @map("death_date")
  fatherName           String?                  @map("father_name")
  gender               String?
  isDisabled           Boolean                  @default(false) @map("is_disabled")
  maritalStatus        String?                  @map("marital_status")
  motherName           String?                  @map("mother_name")
  nationality          String?
  naturalness          String?
  neighborhood         String?
  number               String?
  postalCode           String?                  @map("postal_code")
  race                 String?
  socialName           String?                  @map("social_name")
  state                String?
  numberUnlock         Int?                     @default(0) @map("number_unlock")
  auditLogs            AuditLog[]
  cares                Care[]
  foldersResponsible   Folder[]                 @relation("ProfessionalResponsible")
  notifications        Notification[]
  regulationsAnalyzed  Regulation[]             @relation("regulation_analyzer")
  regulationsCreated   Regulation[]             @relation("regulation_creator")
  regulationsPrinted   Regulation[]             @relation("regulation_printer")
  employments          ProfessionalEmployment[]
  subscriber           Subscriber?              @relation(fields: [subscriberId], references: [id])
  subscriberId         Int?

  @@unique([email, cpf])
  @@unique([subscriberId, cpf], map: "professional_subscriber_cpf_key")
  @@index([email])
  @@index([subscriberId])
  @@map("professional")
}

model ProfessionalEmployment {
  id             Int       @id @default(autoincrement())
  uuid           String    @unique @default(uuid()) @db.Uuid
  professionalId Int       @map("professional_id")
  subscriberId   Int?      @map("subscriber_id")
  role           Role
  isActive       Boolean   @default(true) @map("is_active")
  isPrimary      Boolean   @default(false) @map("is_primary")
  startDate      DateTime  @default(now()) @map("start_date")
  endDate        DateTime? @map("end_date")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  professional Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  subscriber   Subscriber?  @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@unique([professionalId, subscriberId, role])
  @@index([professionalId])
  @@index([subscriberId])
  @@index([role])
  @@index([isActive])
  @@map("professional_employment")
}

model Regulation {
  id                     Int              @id @default(autoincrement())
  uuid                   String           @unique @default(uuid()) @db.Uuid
  subscriberId           Int              @map("subscriber_id")
  idCode                 String?          @map("id_code")
  patientId              Int?             @map("patient_id")
  responsibleId          Int?             @map("responsible_id")
  requestDate            DateTime?        @map("request_date")
  scheduledDate          DateTime?        @map("scheduled_date")
  resolvedAt             DateTime?        @map("resolved_at")
  printerAt              DateTime?        @map("printer_at")
  status                 Status?
  notes                  String?          @db.Text
  clinicalIndication     String?          @map("clinical_indication") @db.Text
  cid                    String?
  urlRequirement         String?          @map("url_requirement")
  urlPreDocument         String?          @map("url_pre_document")
  urlCurrentDocument     String?          @map("url_current_document")
  folderId               Int?             @map("folder_id")
  relationship           Relationship?
  priority               Priority?        @default(ELECTIVE)
  typeDeclaration        TypeDeclaration? @map("type_declaration")
  requestingProfessional String?          @map("requesting_professional")
  creatorId              Int?             @map("creator_id")
  analyzedId             Int?             @map("analyzed_id")
  printerId              Int?             @map("printer_id")

  supplierId      Int?             @map("supplier_id")
  history         Int?             @default(1)
  versionDocument Int?             @default(1) @map("version_document")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")
  deletedAt       DateTime?        @map("deleted_at")
  cares           CareRegulation[]
  notifications   Notification[]
  analyzer        Professional?    @relation("regulation_analyzer", fields: [analyzedId], references: [id])
  creator         Professional?    @relation("regulation_creator", fields: [creatorId], references: [id])
  folder          Folder?          @relation(fields: [folderId], references: [id])
  patient         Patient?         @relation("PatientRegulation", fields: [patientId], references: [id])
  printer         Professional?    @relation("regulation_printer", fields: [printerId], references: [id])
  responsible     Patient?         @relation("ResponsibleRegulation", fields: [responsibleId], references: [id])
  subscriber      Subscriber       @relation(fields: [subscriberId], references: [id], onDelete: Cascade)
  supplier        Supplier?        @relation(fields: [supplierId], references: [id])

  @@index([subscriberId])
  @@index([patientId])
  @@index([folderId])
  @@index([supplierId])
  @@index([creatorId])
  @@index([analyzedId])
  @@index([printerId])
  @@index([subscriberId, status])
  @@index([subscriberId, createdAt])
  @@index([subscriberId, status, deletedAt])
  @@index([subscriberId, requestDate(sort: Desc)])
  @@index([patientId, status])
  @@map("regulation")
}

model Supplier {
  id           Int          @id @default(autoincrement())
  uuid         String       @unique @default(uuid()) @db.Uuid
  subscriberId Int          @map("subscriber_id")
  name         String
  tradeName    String       @map("trade_name")
  cnpj         String
  postalCode   String?      @map("postal_code")
  city         String?
  state        String?
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  deletedAt    DateTime?    @map("deleted_at")
  cares        Care[]
  regulations  Regulation[]
  subscriber   Subscriber   @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@unique([subscriberId, cnpj])
  @@index([subscriberId])
  @@map("supplier")
}

model CareRegulation {
  id           Int        @id @default(autoincrement())
  subscriberId Int        @map("subscriber_id")
  careId       Int        @map("care_id")
  regulationId Int        @map("regulation_id")
  quantity     Int        @default(1)
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  care         Care       @relation(fields: [careId], references: [id], onDelete: Cascade)
  regulation   Regulation @relation(fields: [regulationId], references: [id], onDelete: Cascade)
  subscriber   Subscriber @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@unique([careId, regulationId])
  @@index([careId])
  @@index([regulationId])
  @@index([subscriberId])
  @@map("care_regulation")
}

model TermsOfUse {
  id        Int       @id @default(autoincrement())
  uuid      String    @unique @default(uuid()) @db.Uuid
  version   String    @unique
  title     String
  content   String    @db.Text
  isActive  Boolean   @default(false) @map("is_active")
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@index([isActive])
  @@index([version])
  @@map("terms_of_use")
}

model Notification {
  id             Int              @id @default(autoincrement())
  uuid           String           @unique @default(uuid()) @db.Uuid
  subscriberId   Int              @map("subscriber_id")
  regulationId   Int              @map("regulation_id")
  title          String
  message        String           @db.Text
  type           NotificationType
  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")
  readAt         DateTime?        @map("read_at")
  deletedAt      DateTime?        @map("deleted_at")
  professionalId Int              @map("professional_id")
  daysCount      Int?             @map("days_count")
  patientName    String?          @map("patient_name")
  priority       Priority?
  scheduledDate  DateTime?        @map("scheduled_date")

  professional Professional @relation(fields: [professionalId], references: [id], onDelete: Cascade)
  regulation   Regulation   @relation(fields: [regulationId], references: [id])
  subscriber   Subscriber   @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@index([subscriberId])
  @@index([professionalId])
  @@index([regulationId])
  @@index([createdAt])
  @@index([subscriberId, createdAt])
  @@map("notification")
}

model WhatsAppConfig {
  id           Int        @id @default(autoincrement())
  uuid         String     @unique @default(uuid()) @db.Uuid
  subscriberId Int        @unique @map("subscriber_id")
  instanceName String     @unique @map("instance_name")
  apiKey       String?    @map("api_key")
  provider     String     @default("evolution")
  credentials  Json?
  isActive     Boolean    @default(true) @map("is_active")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  subscriber   Subscriber @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@index([subscriberId])
  @@map("whatsapp_config")
}

model PatientDocument {
  id           Int                 @id @default(autoincrement())
  uuid         String              @unique @db.Uuid
  subscriberId Int                 @map("subscriber_id")
  patientId    Int                 @map("patient_id")
  documentType PatientDocumentType @map("document_type")
  category     DocumentCategory
  fileName     String              @map("file_name")
  url          String
  createdAt    DateTime            @default(now()) @map("created_at")
  updatedAt    DateTime            @map("updated_at")
  deletedAt    DateTime?           @map("deleted_at")
  patient      Patient             @relation(fields: [patientId], references: [id], onDelete: Cascade)
  subscriber   Subscriber          @relation(fields: [subscriberId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([documentType])
  @@index([patientId])
  @@index([subscriberId])
  @@index([subscriberId, patientId])
  @@map("patient_document")
}
